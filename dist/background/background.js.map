{"version":3,"file":"background.js","sources":["../../src/background/background.js"],"sourcesContent":["chrome.runtime.onInstalled.addListener((details) => {\n  if (details.reason === \"install\") chrome.runtime.openOptionsPage();\n});\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.action === \"openOptionsPage\") {\n    chrome.runtime.openOptionsPage();\n    sendResponse({ success: true });\n    return false;\n  }\n\n  if (message.action === \"verifyApiKey\") {\n    verifyApiKey(message.apiKey)\n      .then((result) => {\n        if (result.valid) {\n          chrome.storage.sync.set({ openai_api_key: message.apiKey }, () => {\n            chrome.storage.local.set({ openai_api_key: message.apiKey }, () => {\n              sendResponse(result);\n            });\n          });\n        } else {\n          sendResponse(result);\n        }\n      })\n      .catch((error) => sendResponse({ valid: false, error: error.message }));\n    return true;\n  }\n\n  if (message.action === \"checkStorage\") {\n    chrome.storage.sync.get(null, function (syncItems) {\n      chrome.storage.local.get(null, function (localItems) {\n        try {\n          sendResponse({\n            syncStorage: syncItems,\n            localStorage: localItems,\n          });\n        } catch (error) {\n          console.error(\"Error sending response:\", error);\n        }\n      });\n    });\n    return true;\n  }\n\n  if (message.action === \"getApiKey\") {\n    chrome.storage.local.get([\"openai_api_key\"], function (localItems) {\n      if (localItems.openai_api_key) {\n        try {\n          sendResponse({ apiKey: localItems.openai_api_key });\n        } catch (error) {\n          console.error(\"Error sending response:\", error);\n        }\n      } else {\n        chrome.storage.sync.get([\"openai_api_key\"], function (syncItems) {\n          try {\n            if (syncItems.openai_api_key) {\n              chrome.storage.local.set({\n                openai_api_key: syncItems.openai_api_key,\n              });\n              sendResponse({ apiKey: syncItems.openai_api_key });\n            } else {\n              sendResponse({ apiKey: null });\n            }\n          } catch (error) {\n            console.error(\"Error sending response:\", error);\n          }\n        });\n      }\n    });\n    return true;\n  }\n\n  if (message.action === \"settingsUpdated\") {\n    try {\n      chrome.tabs.query({ url: \"https://web.whatsapp.com/*\" }, (tabs) => {\n        try {\n          if (tabs && tabs.length > 0) {\n            tabs.forEach((tab) => {\n              try {\n                chrome.tabs.sendMessage(\n                  tab.id,\n                  { action: \"settingsUpdated\" },\n                  () => {\n                    const lastError = chrome.runtime.lastError;\n                    if (lastError) {\n                      console.log(\n                        `Error sending message to tab ${tab.id}: ${lastError.message}`\n                      );\n                    }\n                  }\n                );\n              } catch (tabError) {\n                console.log(`Error in tab message: ${tabError.message}`);\n              }\n            });\n          }\n\n          sendResponse({ success: true });\n        } catch (innerError) {\n          console.error(\"Error processing tabs:\", innerError);\n          sendResponse({ success: true, warning: \"Error notifying tabs\" });\n        }\n      });\n    } catch (outerError) {\n      console.error(\"Error in tabs.query:\", outerError);\n      sendResponse({ success: true, warning: \"Error querying tabs\" });\n    }\n    return true;\n  }\n\n  return false;\n});\n\n/** @param {string} apiKey */\nasync function verifyApiKey(apiKey) {\n  if (!apiKey) return { valid: false, error: \"API key is empty\" };\n\n  if (!apiKey.startsWith(\"sk-\"))\n    return { valid: false, error: \"Invalid API key format\" };\n\n  try {\n    const response = await fetch(\"https://api.openai.com/v1/models\", {\n      method: \"GET\",\n      headers: {\n        Authorization: `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/json\",\n      },\n    });\n\n    if (!response.ok) {\n      const error = await response.json();\n      return { valid: false, error: error.error.message || \"Invalid API key\" };\n    }\n\n    return { valid: true };\n  } catch (error) {\n    return { valid: false, error: error.message || \"Network error\" };\n  }\n}\n\nchrome.storage.sync.get([\"openai_api_key\"], function (result) {\n  if (result.openai_api_key)\n    chrome.storage.local.set({ openai_api_key: result.openai_api_key });\n});\n"],"names":[],"mappings":"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"}