{"version":3,"file":"background.js","sources":["../../src/background/background.js"],"sourcesContent":["chrome.runtime.onInstalled.addListener((details) => {\n  if (details.reason === \"install\") chrome.runtime.openOptionsPage();\n});\n\nchrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\n  if (message.action === \"openOptionsPage\") {\n    chrome.runtime.openOptionsPage();\n    sendResponse({ success: true });\n  }\n\n  if (message.action === \"verifyApiKey\") {\n    verifyApiKey(message.apiKey)\n      .then((result) => {\n        if (result.valid) {\n          chrome.storage.sync.set({ openai_api_key: message.apiKey });\n          chrome.storage.local.set({ openai_api_key: message.apiKey });\n        }\n        sendResponse(result);\n      })\n      .catch((error) => sendResponse({ valid: false, error: error.message }));\n\n    return true;\n  }\n\n  if (message.action === \"checkStorage\") {\n    chrome.storage.sync.get(null, function (syncItems) {\n      chrome.storage.local.get(null, function (localItems) {\n        sendResponse({\n          syncStorage: syncItems,\n          localStorage: localItems,\n        });\n      });\n    });\n    return true;\n  }\n\n  if (message.action === \"getApiKey\") {\n    chrome.storage.local.get([\"openai_api_key\"], function (localItems) {\n      if (localItems.openai_api_key)\n        sendResponse({ apiKey: localItems.openai_api_key });\n      else {\n        chrome.storage.sync.get([\"openai_api_key\"], function (syncItems) {\n          if (syncItems.openai_api_key) {\n            chrome.storage.local.set({\n              openai_api_key: syncItems.openai_api_key,\n            });\n            sendResponse({ apiKey: syncItems.openai_api_key });\n          } else sendResponse({ apiKey: null });\n        });\n      }\n    });\n    return true;\n  }\n\n  if (message.action === \"settingsUpdated\") {\n    console.log(\"Settings updated, notifying tabs\");\n    chrome.tabs.query({ url: \"https://web.whatsapp.com/*\" }, (tabs) => {\n      tabs.forEach((tab) =>\n        chrome.tabs.sendMessage(tab.id, { action: \"settingsUpdated\" })\n      );\n    });\n\n    sendResponse({ success: true });\n  }\n});\n\n/** @param {string} apiKey */\nasync function verifyApiKey(apiKey) {\n  if (!apiKey) return { valid: false, error: \"API key is empty\" };\n\n  if (!apiKey.startsWith(\"sk-\"))\n    return { valid: false, error: \"Invalid API key format\" };\n\n  const response = await fetch(\"https://api.openai.com/v1/models\", {\n    method: \"GET\",\n    headers: {\n      Authorization: `Bearer ${apiKey}`,\n      \"Content-Type\": \"application/json\",\n    },\n  });\n\n  if (!response.ok) {\n    const error = await response.json();\n    return { valid: false, error: error.error.message || \"Invalid API key\" };\n  }\n\n  return { valid: true };\n}\n\nchrome.storage.sync.get([\"openai_api_key\"], function (result) {\n  if (result.openai_api_key)\n    chrome.storage.local.set({ openai_api_key: result.openai_api_key });\n});\n"],"names":[],"mappings":"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"}