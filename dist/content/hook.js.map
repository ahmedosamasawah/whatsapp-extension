{"version":3,"file":"hook.js","sources":["../../src/content/hook.js"],"sourcesContent":["(() => {\n  const audioMap = new Map();\n  const originalCreateObjectURL = URL.createObjectURL;\n\n  URL.createObjectURL = function (blob) {\n    const url = originalCreateObjectURL.apply(this, arguments);\n\n    if (blob?.type?.startsWith(\"audio/\")) {\n      audioMap.set(url, {\n        blob,\n        mime: blob.type,\n        sent: false,\n      });\n    }\n\n    return url;\n  };\n\n  /** @param {string} url */\n  function processAndSendAudio(url) {\n    const record = audioMap.get(url);\n    if (!record || record.sent) return;\n\n    record.sent = true;\n\n    record.blob.arrayBuffer().then((buffer) => {\n      window.postMessage(\n        {\n          source: \"WA_TRANSCRIBER\",\n          type: \"WA_AUDIO\",\n          mime: record.mime,\n          data: [...new Uint8Array(buffer)],\n        },\n        \"*\"\n      );\n    });\n  }\n\n  /** @param {Object} obj */\n  function patchSrcSetter(obj) {\n    const descriptor =\n      Object.getOwnPropertyDescriptor(obj, \"src\") ||\n      Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, \"src\");\n\n    Object.defineProperty(obj, \"src\", {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return descriptor.get.call(this);\n      },\n      set(value) {\n        processAndSendAudio(value);\n        return descriptor.set.call(this, value);\n      },\n    });\n  }\n\n  const nativeAudio = Audio;\n  window.Audio = new Proxy(nativeAudio, {\n    construct(Target, args, newTarget) {\n      const audio = Reflect.construct(Target, args, newTarget);\n\n      if (args[0]) processAndSendAudio(args[0]);\n\n      patchSrcSetter(audio);\n\n      return audio;\n    },\n  });\n\n  patchSrcSetter(HTMLMediaElement.prototype);\n})();\n"],"names":[],"mappings":"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"}