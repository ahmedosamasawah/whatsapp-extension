{"version":3,"file":"hook.js","sources":["../../src/content/hook.js"],"sourcesContent":["(() => {\n  // Map to track audio blob URLs\n  const audioMap = new Map();\n\n  // Store original createObjectURL method\n  const origCreate = URL.createObjectURL;\n\n  // Intercept URL.createObjectURL to capture audio blobs\n  URL.createObjectURL = function (blob) {\n    // Call original method\n    const url = origCreate.apply(this, arguments);\n\n    // If this is an audio blob, store it\n    if (blob?.type?.startsWith(\"audio/\")) {\n      audioMap.set(url, {\n        blob,\n        mime: blob.type,\n        sent: false,\n      });\n    }\n\n    return url;\n  };\n\n  /**\n   * Check if a URL is for audio and send it to the content script if not already sent\n   */\n  function maybeSend(url) {\n    const rec = audioMap.get(url);\n    if (!rec || rec.sent) return;\n\n    // Mark as sent\n    rec.sent = true;\n\n    // Convert blob to array buffer and send to content script\n    rec.blob.arrayBuffer().then((buf) => {\n      window.postMessage(\n        {\n          source: \"WA_TRANSCRIBER\",\n          type: \"WA_AUDIO\",\n          mime: rec.mime,\n          data: [...new Uint8Array(buf)],\n        },\n        \"*\"\n      );\n    });\n  }\n\n  /**\n   * Patch the src setter on an HTMLElement to intercept audio URLs\n   */\n  function patchSrcSetter(obj) {\n    // Get original descriptor\n    const desc =\n      Object.getOwnPropertyDescriptor(obj, \"src\") ||\n      Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, \"src\");\n\n    // Replace with our interceptor\n    Object.defineProperty(obj, \"src\", {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return desc.get.call(this);\n      },\n      set(v) {\n        maybeSend(v);\n        return desc.set.call(this, v);\n      },\n    });\n  }\n\n  // Intercept Audio constructor\n  const NativeAudio = Audio;\n  window.Audio = new Proxy(NativeAudio, {\n    construct(Target, args, newTarget) {\n      const audio = Reflect.construct(Target, args, newTarget);\n      if (args[0]) maybeSend(args[0]);\n      patchSrcSetter(audio);\n      return audio;\n    },\n  });\n\n  // Patch HTMLMediaElement.prototype for all existing and future audio/video elements\n  patchSrcSetter(HTMLMediaElement.prototype);\n})();\n"],"names":[],"mappings":"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"}